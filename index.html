<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOHAMED HAMDANI</title>
    <!-- Quill.js CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 1rem;
            text-align: center;
        }
        nav {
            display: flex;
            justify-content: center;
            background-color: #444;
            padding: 0.5rem;
        }
        nav a {
            color: #fff;
            text-decoration: none;
            padding: 0.5rem 1rem;
        }
        nav a:hover {
            background-color: #555;
        }
        .section {
            padding: 2rem;
            display: none;
        }
        .section.active {
            display: block;
        }
        .lang-switcher {
            text-align: center;
            padding: 1rem;
        }
        .lang-switcher button {
            padding: 0.5rem 1rem;
            cursor: pointer;
        }
        footer {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 1rem;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        #post-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }
        #post-form input {
            padding: 0.5rem;
            font-size: 1rem;
        }
        #post-form button {
            padding: 0.5rem 1rem;
            cursor: pointer;
            width: fit-content;
        }
        /* Quill editor style */
        #editor {
            height: 250px;
        }
        .post-article {
            border-bottom: 1px solid #ccc;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        .post-actions button {
            margin-left: 10px;
        }
    </style>
</head>
<body>

    <header>
        <h1>MOHAMED HAMDANI</h1>
    </header>

    <nav>
        <a href="#home" onclick="showSection('home')">Home</a>
        <a href="#about" onclick="showSection('about')">About Me</a>
        <a href="#contact" onclick="showSection('contact')">Contact Me</a>
        <a href="#blog" onclick="showSection('blog')">Blog</a>
    </nav>

    <div class="lang-switcher">
        <button onclick="switchLang('en')">English</button>
        <button onclick="switchLang('ar')">العربية</button>
    </div>

    <div id="home" class="section active">
        <h2 data-en="Welcome to my Website" data-ar="مرحبا بكم في موقعي">Welcome to my Website</h2>
        <p data-en="This is the homepage." data-ar="هذه هي الصفحة الرئيسية.">This is the homepage.</p>
    </div>

    <div id="about" class="section">
        <h2 data-en="About Me" data-ar="عني">About Me</h2>
        <p data-en="This is the about me page." data-ar="هذه هي صفحة عني.">This is the about me page.</p>
    </div>

    <div id="contact" class="section">
        <h2 data-en="Contact Me" data-ar="اتصل بي">Contact Me</h2>
        <p data-en="You can reach me at:" data-ar="يمكنك التواصل معي عبر:"></p>
        <ul>
            <li data-en="Email: Medo300@gmail.com" data-ar="البريد الإلكتروني: Medo300@gmail.com">Email: Medo300@gmail.com</li>
            <li data-en="Phone: +61410207299" data-ar="الهاتف: +61410207299">Phone: +61410207299</li>
        </ul>
        <h3 data-en="Social Media" data-ar="وسائل التواصل الاجتماعي">Social Media</h3>
        <ul>
            <li><a href="https://twitter.com/MedoHamdani" target="_blank">Twitter</a></li>
            <li><a href="https://www.instagram.com/medo_hamdani/" target="_blank">Instagram</a></li>
            <li><a href="https://www.youtube.com/c/MedoHamdani" target="_blank">YouTube</a></li>
            <li><a href="https://www.facebook.com/MedoHamdani" target="_blank">Facebook</a></li>
            <li><a href="https://www.linkedin.com/in/medohamdani/" target="_blank">LinkedIn</a></li>
            <li><a href="https://github.com/MedoHamdani" target="_blank">GitHub</a></li>
        </ul>
    </div>

    <div id="blog" class="section">
        <h2 data-en="Blog" data-ar="المدونة">Blog</h2>
        <div id="posts-container"></div>
        <hr>
        <h3 id="form-title" data-en="New Post" data-ar="منشور جديد">New Post</h3>
        <form id="post-form">
            <input type="hidden" id="editing-path">
            <input type="hidden" id="editing-sha">
            <input type="text" id="post-title" placeholder="Post Title" required>
            <div id="editor"></div>
            <input type="password" id="github-token" placeholder="GitHub Token" required>
            <button type="submit" id="submit-button">Publish</button>
            <button type="button" id="cancel-edit" style="display:none;">Cancel Edit</button>
        </form>
    </div>

    <footer>
        <p>&copy; 2024 MOHAMED HAMDANI</p>
    </footer>

    <!-- Quill.js -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
        const REPO_OWNER = 'MedoHamdani';
        const REPO_NAME = 'MedoHamdani.github.io';
        
        const quill = new Quill('#editor', {
            theme: 'snow'
        });

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            if (sectionId === 'blog') {
                loadPosts();
            }
        }

        function switchLang(lang) {
            document.querySelectorAll('[data-en]').forEach(el => {
                el.textContent = el.dataset[lang];
            });
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        }

        async function loadPosts() {
            const postsContainer = document.getElementById('posts-container');
            postsContainer.innerHTML = 'Loading posts...';
            try {
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/_posts`);
                const files = await response.json();
                if (response.ok && Array.isArray(files)) {
                    postsContainer.innerHTML = '';
                    for (const file of files) {
                        const postResponse = await fetch(file.download_url);
                        const postContent = await postResponse.text();
                        const postElement = document.createElement('div');
                        postElement.classList.add('post-article');
                        const postTitle = file.name.replace(/\.html$/, '').replace(/-/g, ' ');
                        
                        postElement.innerHTML = `
                            <h3>${postTitle}</h3>
                            <div>${postContent}</div>
                            <div class="post-actions">
                                <button onclick="startEdit('${file.path}', '${file.sha}')">Edit</button>
                                <button onclick="deletePost('${file.path}', '${file.sha}')">Delete</button>
                            </div>
                        `;
                        postsContainer.appendChild(postElement);
                    }
                } else {
                    postsContainer.innerHTML = 'No posts found.';
                }
            } catch (error) {
                console.error('Error loading posts:', error);
                postsContainer.innerHTML = 'Error loading posts.';
            }
        }

        async function startEdit(path, sha) {
            try {
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`);
                const file = await response.json();
                if (!response.ok) throw new Error(file.message);

                const postContent = decodeURIComponent(escape(atob(file.content)));
                const postTitle = file.name.replace(/\.html$/, '').replace(/-/g, ' ');

                document.getElementById('editing-path').value = path;
                document.getElementById('editing-sha').value = sha;
                document.getElementById('post-title').value = postTitle;
                document.getElementById('post-title').disabled = true; // Prevent changing title/filename
                quill.root.innerHTML = postContent;

                document.getElementById('form-title').textContent = 'Edit Post';
                document.getElementById('submit-button').textContent = 'Update Post';
                document.getElementById('cancel-edit').style.display = 'inline-block';
                
                document.getElementById('post-form').scrollIntoView();

            } catch (error) {
                console.error('Error loading post for editing:', error);
                alert('Error loading post for editing: ' + error.message);
            }
        }
        
        document.getElementById('cancel-edit').addEventListener('click', () => {
            document.getElementById('post-form').reset();
            quill.root.innerHTML = '';
            document.getElementById('editing-path').value = '';
            document.getElementById('editing-sha').value = '';
            document.getElementById('post-title').disabled = false;
            document.getElementById('form-title').textContent = 'New Post';
            document.getElementById('submit-button').textContent = 'Publish';
            document.getElementById('cancel-edit').style.display = 'none';
        });

        async function deletePost(path, sha) {
            const token = prompt('Please enter your GitHub token to delete this post:');
            if (!token) {
                alert('Token is required to delete posts.');
                return;
            }

            if (!confirm('Are you sure you want to delete this post? This cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Delete post: ${path}`,
                        sha: sha,
                    }),
                });

                if (response.ok) {
                    alert('Post deleted successfully!');
                    loadPosts();
                } else {
                    const error = await response.json();
                    alert(`Error deleting post: ${error.message}`);
                }
            } catch (error) {
                console.error('Error deleting post:', error);
                alert('An error occurred while deleting the post.');
            }
        }

        document.getElementById('post-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const title = document.getElementById('post-title').value;
            const content = quill.root.innerHTML;
            const token = document.getElementById('github-token').value;

            if (!title || content === '<p><br></p>' || !token) {
                alert('Please fill in all fields.');
                return;
            }

            const editingPath = document.getElementById('editing-path').value;
            const fileName = `${title.replace(/\s+/g, '-')}.html`;
            const filePath = editingPath || `_posts/${fileName}`;
            
            const fileContent = btoa(unescape(encodeURIComponent(content)));
            
            const body = {
                message: `Post: ${title}`,
                content: fileContent,
                sha: document.getElementById('editing-sha').value || undefined
            };

            try {
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body),
                });

                if (response.ok) {
                    alert('Post saved successfully!');
                    document.getElementById('cancel-edit').click(); // Reset form
                    loadPosts();
                } else {
                    const error = await response.json();
                    alert(`Error saving post: ${error.message}`);
                }
            } catch (error) {
                console.error('Error saving post:', error);
                alert('An error occurred while saving the post.');
            }
        });

        // Show home section by default
        showSection('home');
    </script>

</body>
</html>
